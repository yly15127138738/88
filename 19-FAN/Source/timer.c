/*********************************************************************************************
* 文件：timer.h
* 作者：Meixin 2017.09.27
* 说明：定时器驱动代码 
* 修改：
* 注释：
*********************************************************************************************/

/*********************************************************************************************
* 头文件
*********************************************************************************************/
#include "timer.h"

/*********************************************************************************************
* 名称：xtal_init()
* 功能：CC2530时钟初始化
* 参数：无
* 返回：无
* 修改：
* 注释：
*********************************************************************************************/
void xtal_init(void)
{
    CLKCONCMD &= ~0x40;                                           //选择32MHz的外部晶振
    while(CLKCONSTA & 0x40);                                      //晶体振荡器开启且稳定
    CLKCONCMD &= ~0x07;                                           //选择32MH系统时钟
    CLKCONCMD |= 0x38;                                            //时钟速度32 MHz 定时器标记输出设置[5:3]250kHz
}

/*********************************************************************************************
* 名称：time1_init()
* 功能：定时器1初始化
* 参数：无
* 返回：无
* 修改：
* 注释：
*********************************************************************************************/
void time1_init(void)
{
    unsigned short t1cc0=250;
    
    P0SEL |= (1<<4);                                            //配置管脚为外设模式
    P0DIR |= (1<<4);                                            //配置控制管脚为输出模式
    P2DIR |= (11<<6);
    PERCFG &= ~(1<<6);
                                          //定时器通道设置,备用位置1
    
    T1CTL |= (1<<1);                                            //定时器1 控制，模模式,0分频
    T1CC0L = t1cc0&0xff;                                        //定时器1 通道0 捕获/比较值低位
    T1CC0H = (t1cc0>>8)&0xff;                                   //定时器1 通道0 捕获/比较值高位
    
    T1CC2L = 0x01;                                          //定时器1 通道0 捕获/比较值低位
    T1CC2H = 0x00;                                          //定时器1 通道0 捕获/比较值高位
    T1CCTL2 = (1<<2)+(5<<3);                                    //定时器1 通道2 捕获/比较控制
    T1IE = 0;
}
void time1_ON(void){
    T1IE = 1;
}
void time1_OFF(void){
T1IE = 0;
}

